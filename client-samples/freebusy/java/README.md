<!---
  Â© Copyright IBM Corp. 2017
  
  Licensed under the Apache License, Version 2.0 (the "License"); 
  you may not use this file except in compliance with the License. 
  You may obtain a copy of the License at:
  
  http://www.apache.org/licenses/LICENSE-2.0 
  
  Unless required by applicable law or agreed to in writing, software 
  distributed under the License is distributed on an "AS IS" BASIS, 
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or 
  implied. See the License for the specific language governing 
--->

# Java samples using the DAS Freebusy API
Sample code showing use of Domino Access Services (DAS) with Swagger
generated client code.  You can use this code to test freebusy API
client code generated by
[Swagger Codegen](https://github.com/swagger-api/swagger-codegen).

### Prerequisites
- A Domino server with the freebusy API installed and enabled.
- A Java development kit (JDK).  Java 7 is the minimum required
  version.
- Apache Maven to build the Java code and automatically manage
  dependencies.
- A Java client package generated from **freebusy.yaml**.  For example,
  you can use the [online Swagger editor](http://editor2.swagger.io)
  to import **freebusy.yaml** and then generate a "Java" client.
  (*Note:* This repository does not include the generated code.)
  
### Required JARs
The generated client package includes a Maven project object module 
(**pom.xml**) identifying several required JARs.  Therefore, we
recommend you use Maven to automatically build
the project and manage its dependencies.  If you choose not to
use Maven, the list of required JARs is as currently follows:  

- gson-2.6.2.jar
- joda-time-2.9.3.jar
- logging-interceptor-2.7.5.jar
- okhttp-2.7.5.jar
- okio-1.6.0.jar
- swagger-annotations-1.5.9.jar

This list depends on the version of Swagger Codegen and is subject
to change without notice.  (In other words, you really should use
Maven!)

# Instructions
These instructions show how to build and run
[BusyTimeTest.java](client/freebusy/test/BusyTimeTest.java).  To run
a different freebusy client sample, follow these same instructions
and substitute file names where appropriate.

First create a root folder and sub-folder as shown below:

```
/tests
/tests/swagger-java-client
```

The root folder name is not important.  Choose a name other than
**/tests** if necessary.

### Unzip the generated client code
Unzip the generated code to **/tests/swagger-java-client**.  When you
are finished, the contents of the folder should look something like
this:

```
docs
gradle
src
.gitignore
.swagger-codegen-ignore
.travis.yml
build.gradle
build.sbt
git_push.sh
gradle.properties
gradlew
gradlew.bat
pom.xml
README.md
settings.gradle
```

### Use Maven to build the generated client code
Build the generated client code and install it to your local Maven
repository:

```
cd /tests/swagger-java-client
mvn install
```

This step may take several seconds to complete.  Move on to
the next step only when you are sure you have a successful build:

```
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.896 s
[INFO] Finished at: 2017-02-22T14:26:49-05:00
[INFO] Final Memory: 20M/34M
[INFO] ------------------------------------------------------------------------
```

### Create your freebusy API test project
Now run the following two commands:

```
cd /tests
mvn archetype:generate -DgroupId=client.freebusy.test -DartifactId=client-freebusy-test -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
```

That second command is definitely a mouthful, but when successful,
it automatically creates a new Maven project based on a common
template.  The new project is in a folder called
**/tests/client-freebusy-test**.  You might want to take a
moment to explore the contents of the new folder now.

### Customize your test project
Look for a file named **pom.xml** in the
**/tests/client-freebusy-test** folder.  Open **pom.xml**
in your favorite text editor and add the following lines
inside the existing `<dependencies>` element:

```
<dependency>
    <groupId>io.swagger</groupId>
    <artifactId>swagger-java-client</artifactId>
    <version>1.0.0</version>
    <scope>compile</scope>
</dependency>
```

Save your changes to **pom.xml**.

Now download [BusyTimeTest.java](client/freebusy/test/BusyTimeTest.java)
to the **/tests/client-freebusy-test/src/main/java/client/freebusy/test**
folder.  Then open your local copy of **BusyTimeTest.java** in a text
editor and customize the following values for your environment:

```java
// IMPORTANT: Change these values to match your test environment:
//
// - basePath is the base URL for your Domino server.
//   The freebusy service MUST be installed and enabled
//   on the server. Be sure to change the protocol to
//   https if necessary.
//
// - user is the user name for HTTP authentication
//
// - password is the user's HTTP password
//
// - lookupName is the email address of a VALID user.
//
// - days is number of days of busy time data to return.
//
String basePath = "http://yourserver.yourorg.com";
String user = "First Last";
String password = "password";
String lookupName = "user@yourorg.com";
Integer days = 7;
```

### Build your test project
Run the following two commands:

```
cd /tests/client-freebusy-test
mvn package
```

If your build is successful, you should see the following:

```
[INFO]
[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ client-freebusy-test ---
[INFO] Building jar: /tests/client-freebusy-test/target/client-freebusy-test-1.0-SNAPSHOT.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.870 s
[INFO] Finished at: 2017-02-22T15:04:06-05:00
[INFO] Final Memory: 15M/25M
[INFO] ------------------------------------------------------------------------
```

### Run your test project
On Linux run the following command (note the use of *colons* to
separate folders in the classpath):

```
java -cp "target/*:../swagger-java-client/target/*:../swagger-java-client/target/lib/*" client.freebusy.test.BusyTimeTest
```

On the other hand, if you are using Windows run the following
(note the use of *semicolons* to separate folders in the
classpath):

```
java -cp "target/*;../swagger-java-client/target/*;../swagger-java-client/target/lib/*" client.freebusy.test.BusyTimeTest
```

Either way, the above commands run the **BusyTimeTest** class with
a classpath that includes the **client-freebusy-test** JAR (`target/*`),
the generated client code (`../swagger-java-client/target/*`), and its
dependencies (`../swagger-java-client/target/lib/*`).

A successful run looks something like this:

```
Requesting busytime for dmelnyk@swg.usma.ibm.com ...
Busytime request succeeded.  Response follows ...

start: 2017-02-23T17:00:00; end: 2017-02-23T18:00:00
start: 2017-02-23T22:00:00; end: 2017-02-24T14:00:00
start: 2017-02-24T17:00:00; end: 2017-02-24T18:00:00
start: 2017-02-24T22:00:00; end: 2017-02-27T14:00:00
start: 2017-02-27T17:00:00; end: 2017-02-27T18:00:00
start: 2017-02-27T22:00:00; end: 2017-02-28T14:00:00
start: 2017-02-28T17:00:00; end: 2017-02-28T20:00:00
start: 2017-02-28T22:00:00; end: 2017-03-01T14:00:00
start: 2017-03-01T17:00:00; end: 2017-03-01T18:00:00
start: 2017-03-01T22:00:00; end: 2017-03-02T14:00:00
```

In other words, the **BusyTimeTest** class requests busy time
for the specified user.  If the request succeeds, it writes
each busy time block to the console. The **BusyTimeTest**
class does this with relatively simple calls into the
generated client code.

### Next steps
Here are some other things to try:

- Review **BusyTimeTest.java** to better understand how it uses
  the generated client code.  You might even want to step
  through the code in a debugger.
  
- Add other test classes to the **client-freebusy-test**
  project.  For example, see
  [FreeRoomsTest.java](client/freebusy/test/FreeRoomsTest.java) and
  [SitesTest.java](client/freebusy/test/SitesTest.java).
  As you add each new class, be sure to customize it for
  your test environment and rebuild the test project.  Then
  run the new class and see what it does.

- Explore the generated code in more detail.  You might even
  want to write your own application to integrate with the Domino
  freebusy API.
