<!---
  Â© Copyright IBM Corp. 2017
  
  Licensed under the Apache License, Version 2.0 (the "License"); 
  you may not use this file except in compliance with the License. 
  You may obtain a copy of the License at:
  
  http://www.apache.org/licenses/LICENSE-2.0 
  
  Unless required by applicable law or agreed to in writing, software 
  distributed under the License is distributed on an "AS IS" BASIS, 
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or 
  implied. See the License for the specific language governing 
--->

# Node.js samples using the DAS Freebusy API
Sample code showing use of Domino Access Services (DAS) with Swagger
generated client code.  You can use this code to test freebusy client
code generated by
[Swagger Codegen](https://github.com/swagger-api/swagger-codegen).

### Prerequisites
- A Domino server with the freebusy API installed and enabled.
- A Node.js runtime environment.
- A Node.js package generated from **freebusy.yaml**.  For example,
  you can use the [online Swagger editor](http://editor2.swagger.io)
  to import **freebusy.yaml** and then generate a "Javascript" client.

# Instructions
These instructions show how to install and run [busytimetest.js](busytimetest.js).
To run a different freebusy client sample, follow these same instructions
and substitute file names where appropriate.

First create a root folder and two sub-folders as shown below:

```
/tests
/tests/ibm_domino_freebusy_api
/tests/busytimetest
```

The root folder name is not important.  Choose a name other than
**/tests** if necessary.

### Unzip the generated client code
Next unzip the generated code to **/tests/ibm_domino_freebusy_api**.
When you are finished, the contents of the folder should look
something like this:

```
docs
src
test
.swagger-codegen-ignore
.travis.yml
git_push.sh
mocha.opts
package.json
README.md
```

### Create your Node.js application
Now use **npm** to initialize your Node.js application. Use a Node.js 
command shell to execute the following commands:

```
cd /tests/busytimetest
npm init
```

The **npm** command will prompt you for information about your
application.  Be sure to specify **busytimetest.js** as the
entry point.  Otherwise, you can accept the default values
as shown below:

```
name: (busytimetest)
version: (1.0.0)
description: Freebusy API test
entry point: (index.js) busytimetest.js
test command:
git repository:
keywords:
author:
license: (ISC)
```

Use **npm** to make your application dependent on **ibm_domino_freebusy_api**
(the generated client code):

```
npm install --save ../ibm_domino_freebusy_api
```

Download [busytimetest.js](busytimetest.js) to the **/tests/busytimetest** folder.
Then open your local copy of **busytimetest.js** in your favorite text editor
and customize the following values for your environment:

```javascript
// IMPORTANT: Change these values to match your test environment:
//
// - basePath is the base URL for your Domino server.
//   The freebusy service MUST be installed and enabled
//   on the server.  Be sure to change the protocol to
//   http if your sever doesn't support https.
//
// - username is the name of a user who has access to your
//   Domino server
//
// - password is the user's password
//
// - lookupName is the email address of a VALID user. Or you
//   can specify the lookup name on the command line.
//
// - btOpts.days is number of days of busy time data to return.

var basePath = "https://yourserver.yourorg.com";
var username = "First Last";
var password = "password";
var lookupName = "user@yourorg.com";
var btOpts = { 
  'days': 7
};
```

### Run your Node.js application
After saving your local changes, return to the Node.js command shell to run 
your application:

```
node busytimetest.js
```

The following is some sample output from a successful run:

```
/tests/busytimetest> node busytimetest.js
Requesting busytime for dmelnyk@yourorg.com ...
Busytime API called successfully. Response follows ...

start: 2017-02-21T17:00:00; end: 2017-02-21T18:00:00
start: 2017-02-21T22:00:00; end: 2017-02-22T14:00:00
start: 2017-02-22T17:00:00; end: 2017-02-22T18:00:00
start: 2017-02-22T22:00:00; end: 2017-02-23T14:00:00
start: 2017-02-23T17:00:00; end: 2017-02-23T18:00:00
start: 2017-02-23T22:00:00; end: 2017-02-24T14:00:00
start: 2017-02-24T17:00:00; end: 2017-02-24T18:00:00
start: 2017-02-24T22:00:00; end: 2017-02-27T14:00:00
start: 2017-02-27T17:00:00; end: 2017-02-27T18:00:00
start: 2017-02-27T22:00:00; end: 2017-02-28T14:00:00
```

In other words, the **busytimetest.js** application displays a list
of busy time periods for the specified user -- in this case
**dmelnyk@yourorg.com**.  You can also specify a different user
on the command line.  The following command displays
busy time periods for **rchan@yourorg.com**:

```
node busytimetest.js rchan@yourorg.com
```
